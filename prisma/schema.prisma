generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DATABASE_URL_DIRECT")
}

model Lead {
  id          String     @id @default(uuid())
  nome        String
  email       String     @unique
  telefone    String
  origem      String
  status      String     @default("frio")
  dataCaptcha DateTime   @default(now())
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  consultas   Consulta[]
  
  @@index([email])
  @@index([status])
  @@index([origem])
}

model Imovel {
  id             String       @id @default(uuid())
  tipo           String
  endereco       String
  cidade         String
  estado         String
  preco          Float
  metragem       Float
  descricao      String?
  disponivel     Boolean      @default(true)
  proprietarioId String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  imagens        String[]     @default([])
  status         String       @default("ATIVO")
  consultas      Consulta[]
  proprietario   Proprietario @relation(fields: [proprietarioId], references: [id])
  
  @@index([cidade])
  @@index([estado])
  @@index([disponivel])
  @@index([tipo])
  @@index([status])
}

model Proprietario {
  id        String   @id @default(uuid())
  nome      String
  telefone  String
  email     String   @unique
  cpf       String?  @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  imoveis   Imovel[]
  
  @@index([email])
}

model Consulta {
  id                 String    @id @default(uuid())
  leadId             String
  imovelId           String
  data               DateTime  @default(now())
  resultado          String?
  tipo               String    @default("visita")
  status             String    @default("agendada")
  observacoes        String?
  comissao           Float?
  createdAt          DateTime  @default(now())
  dataFechamento     DateTime?
  motivoCancelamento String?
  updatedAt          DateTime  @updatedAt
  valorProposta      Float?
  imovel             Imovel    @relation(fields: [imovelId], references: [id], onDelete: Cascade)
  lead               Lead      @relation(fields: [leadId], references: [id], onDelete: Cascade)
  
  @@index([data])
  @@index([status])
  @@index([leadId])
  @@index([imovelId])
}

model AnaliseMercado {
  id          String      @id @default(uuid())
  cidade      String
  estado      String      @default("SP")
  valorM2     Float
  valorMinimo Float?
  valorMaximo Float?
  dataAnalise DateTime    @default(now())
  fonte       String
  tendencia   String?
  observacoes String?
  relatorios  Relatorio[]
  
  @@index([cidade])
  @@index([estado])
  @@index([dataAnalise])
}

model Relatorio {
  id          String          @id @default(uuid())
  titulo      String
  tipo        String
  conteudo    String
  dataGeracao DateTime        @default(now())
  periodo     String?
  geradoPor   String?
  analiseId   String?
  analise     AnaliseMercado? @relation(fields: [analiseId], references: [id])
  
  @@index([tipo])
  @@index([dataGeracao])
}

model Auditoria {
  id         String   @id @default(uuid())
  acao       String
  tabela     String
  registroId String?
  usuario    String   @default("sistema")
  dados      String?
  ip         String?
  userAgent  String?
  createdAt  DateTime @default(now())
  
  @@index([acao])
  @@index([tabela])
  @@index([usuario])
  @@index([createdAt])
}

model Usuario {
  id        String   @id @default(uuid())
  nome      String
  email     String   @unique
  senha     String
  role      String   @default("usuario")
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([email])
  @@index([role])
}